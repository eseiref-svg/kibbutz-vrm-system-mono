# 🚀 מדריך בדיקה מהיר - פיצ'ר ניהול לקוחות

## 📋 הכנה (5 דקות)

### שלב 1: הרצת נתוני דמה
```powershell
# בטרמינל PostgreSQL או pgAdmin
psql -U postgres -d naan_vrm -f test-data-qa-clients.sql
```

**מה זה עושה?**
- יוצר 3 לקוחות: #100, #101, #102
- יוצר 2 sales קיימים
- מוודא משתמשים פעילים

### שלב 2: וידוא שהשרתים רצים
```powershell
# חלון 1: שרת Backend
cd naan-vrm-server
npm start

# חלון 2: שרת Frontend
cd naan-vrm-client
npm start
```

---

## 🧪 תרחיש בדיקה #1: בקשה ללקוח קיים (הבדיקה הקריטית!)

### 🎯 מטרה
לוודא שאישור בקשה ללקוח קיים **לא יוצר כפילות** אלא רק sale חדש

### 📝 צעדים

#### A. מנהל ענף - יצירת בקשה
1. **התחבר:** http://localhost:3000
   - אימייל: `manager@test.com`
   - סיסמה: `111222333`

2. **בדוק לקוחות קיימים:**
   - גלול למטה ל"ניהול לקוחות ודרישות תשלום"
   - ✅ **וודא שרואה לקוחות עם מספרי ID:** #100, #101, #102
   - 📸 **צלם מסך** - זה המצב ההתחלתי

3. **פתח טופס בקשה:**
   - לחץ "הגש בקשה ללקוח חדש / דרישת תשלום"
   - לחץ "בחר לקוח קיים"

4. **בחר לקוח:**
   - בחר: **"חברת QA א - טסטים"** (לקוח #100)
   - ✅ וודא שהפרטים מתמלאים אוטומטית
   - ✅ וודא ששדות הלקוח נעולים (disabled)

5. **מלא פרטי העסקה:**
   - סכום: `15000`
   - תנאי תשלום: `+30 ימים`
   - תיאור: `עסקה שנייה ללקוח QA א - בדיקת תיקון`

6. **שלח:**
   - לחץ "שלח בקשה"
   - ✅ הודעת הצלחה

#### B. גזבר - אישור בקשה
1. **התנתק ממנהל ענף**

2. **התחבר כגזבר:**
   - אימייל: `treasury@test.com`
   - סיסמה: `111222333`

3. **בדוק בקשות:**
   - בדשבורד, חפש ווידג'ט "בקשות לקוחות חדשים להוספה"
   - ✅ רואה בקשה חדשה
   - ✅ מציין: **"לקוח קיים (#100)"**

4. **אשר:**
   - לחץ "אשר"
   - אשר בדיאלוג
   - ✅ הבקשה נעלמת

#### C. חזרה למנהל ענף - **הבדיקה הקריטית!**
1. **התנתק מגזבר**

2. **התחבר בחזרה כמנהל ענף:**
   - אימייל: `manager@test.com`
   - סיסמה: `111222333`

3. **בדוק לקוחות:**
   - גלול ל"ניהול לקוחות ודרישות תשלום"
   - 🎯 **תוצאה מצופה:** רואה **רק לקוח אחד** עם #100
   - ❌ **תוצאה שגויה:** רואה 2 לקוחות עם שם זהה (כפילות)

4. **בדוק עסקאות:**
   - לחץ על כרטיס לקוח #100
   - 🎯 **תוצאה מצופה:** רואה **2 עסקאות**:
     - העסקה הישנה (10,000 ₪)
     - העסקה החדשה (15,000 ₪)

5. 📸 **צלם מסך** - זו התוצאה הסופית

---

## ✅ קריטריוני הצלחה

| בדיקה | מצופה | סטטוס |
|-------|-------|-------|
| הצגת מספר לקוח | כל כרטיס מציג #ID | ⬜ |
| בחירת לקוח קיים | רשימה מופיעה + פרטים מתמלאים | ⬜ |
| שדות נעולים | שדות לקוח קיים disabled | ⬜ |
| אישור בקשה | בקשה נעלמת ללא שגיאות | ⬜ |
| **אין כפילויות** | **רק 1 לקוח #100 (לא 2!)** | ⬜ |
| **sale חדש** | **2 עסקאות ללקוח #100** | ⬜ |

---

## 🧪 תרחיש בדיקה #2: בקשה ללקוח חדש

### 📝 צעדים מהירים
1. התחבר כמנהל ענף
2. לחץ "הגש בקשה"
3. **אל תבחר לקוח קיים**
4. מלא פרטים חדשים:
   - שם: `חברת QA ד - חדש`
   - איש קשר: `test`
   - טלפון: `050-1111111`
   - סכום: `8000`
5. שלח → אשר בגזבר
6. ✅ לקוח חדש נוצר (ID > 102)

---

## 🐛 בעיות נפוצות

### בעיה: לא רואה לקוחות
**פתרון:** הרץ את `test-data-qa-clients.sql` שוב

### בעיה: שגיאת התחברות
**פתרון:** וודא סיסמה: `111222333` (לא `123456`)

### בעיה: עדיין רואה כפילויות
**פתרון:** התיקון לא עבד - בדוק את הקוד ב-`server.js` בשורה ~1755

---

## 📊 דוח תוצאות

לאחר הבדיקה, מלא:

- **תאריך בדיקה:** ___________
- **תוצאת תרחיש #1 (לקוח קיים):** ✅ / ❌
- **תוצאת תרחיש #2 (לקוח חדש):** ✅ / ❌
- **בעיות שנמצאו:** ___________
- **הערות:** ___________

---

## 🎯 סיכום

התיקון הקריטי שבוצע:
```javascript
// קוד ישן - יצר לקוח כפול
const newClient = await createNewClient(...)

// קוד חדש - משתמש בלקוח קיים
const clientId = existingClientId || await createNewClient(...)
```

**זמן בדיקה משוער:** 10-15 דקות


